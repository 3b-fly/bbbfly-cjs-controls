/*!
 * @author Jan Nejedly support@3b-fly.eu
 * @copyright Jan Nejedly
 * @version 2.0.0
 * @license see license in 'LICENSE' file
*/

var bbbfly=bbbfly||{};bbbfly.wrapper={};bbbfly.wrapper._onCreated=function(a){if(!a._Stretcher){var b=a.ControlsPanel?a.ControlsPanel:a,c={Type:"ngPanel"};a._Stretcher=ngCreateControl(c,void 0,b.ID);a._Stretcher&&(c.parent=b.ID,c.id=a._Stretcher.ID,ngAddChildControl(b,a._Stretcher),a._Stretcher.Create(c))}};
bbbfly.wrapper._onUpdated=function(){var a=this.ControlsPanel?this.ControlsPanel.ChildControls:this.ChildControls;if(a){var b=bbbfly.wrapper._getWrapperOptions(this),c={value:{position:{start:0,end:0},margin:{start:null,end:null}}};switch(b.Orientation){case bbbfly.wrapper.orientation.vertical:c.float={start:"top",end:"bottom",stretch:"stretch"};c.direction={start:"top",end:"bottom"};c.padding={start:"PaddingBottom",end:"PaddingTop"};c.margin={start:"MarginTop",end:"MarginBottom"};break;case bbbfly.wrapper.orientation.horizontal:c.float=
{start:"left",end:"right",stretch:"stretch"};c.direction={start:"left",end:"right"};c.padding={start:"PaddingRight",end:"PaddingLeft"};c.margin={start:"MarginLeft",end:"MarginRight"};break;default:return}bbbfly.wrapper._overwriteMargin(c,"start",b,"padding");bbbfly.wrapper._overwriteMargin(c,"end",b,"padding");var d=0,f=0,g=[];for(k in a){var e=a[k];if(!this._Stretcher||e!==this._Stretcher)if(bbbfly.wrapper._trackChildControl(this,e),e.Visible){var h=bbbfly.wrapper._getWrapOptions(e,b);switch(h.Float){case bbbfly.wrapper.float[c.float.start]:bbbfly.wrapper._setMargin(c,
"end",h,"margin");bbbfly.wrapper._positionCtrl(e,c,"start",b);bbbfly.wrapper._overwriteMargin(c,"end",h,"margin");d++;break;case bbbfly.wrapper.float[c.float.end]:bbbfly.wrapper._setMargin(c,"start",h,"margin");bbbfly.wrapper._positionCtrl(e,c,"end",b);bbbfly.wrapper._overwriteMargin(c,"start",h,"margin");f++;break;case bbbfly.wrapper.float[c.float.stretch]:g.push(e)}}}a=bbbfly.wrapper._canPlaceStretchCtrls(this,g,c,b);if(0<g.length)for(var l in g)if(e=g[l],h=bbbfly.wrapper._getWrapOptions(e,b),a){var k=
ng_CopyVar(c);bbbfly.wrapper._setMargin(k,"start",h,"margin");bbbfly.wrapper._setMargin(k,"end",h,"margin");bbbfly.wrapper._positionCtrl(e,k,"stretch",b)}else bbbfly.wrapper._positionCtrl(e,c,"hide",b);this._Stretcher&&this._Stretcher.SetVisible(!1);b.AutoSize?(bbbfly.wrapper._setMargin(c,"end",b,"value"),bbbfly.wrapper._autoSize(this,c,b)):!a&&this._Stretcher&&(1>f?(bbbfly.wrapper._setMargin(c,"end",b,"value"),bbbfly.wrapper._positionStretcher(this._Stretcher,c,"start",b),this._Stretcher.SetVisible(!0)):
1>d&&(bbbfly.wrapper._setMargin(c,"start",b,"value"),bbbfly.wrapper._positionStretcher(this._Stretcher,c,"end",b),this._Stretcher.SetVisible(!0)))}};bbbfly.wrapper._getWrapperOptions=function(a){a=ng_CopyVar(a.WrapperOptions);if("object"!==typeof a||null===a)a={};ng_MergeDef(a,{Orientation:bbbfly.wrapper.orientation.vertical,AutoSize:!1,PaddingTop:null,PaddingBottom:null,PaddingLeft:null,PaddingRight:null,TrackChanges:!1});return a};
bbbfly.wrapper._getWrapOptions=function(a,b){a=ng_CopyVar(a.WrapOptions);if("object"!==typeof a||null===a)a={};var c={Float:void 0,MarginTop:void 0,MarginBottom:void 0,MarginLeft:void 0,MarginRight:void 0,TrackChanges:b.TrackChanges};switch(b.Orientation){case bbbfly.wrapper.orientation.vertical:c.Float=bbbfly.wrapper.float.top;break;case bbbfly.wrapper.orientation.horizontal:c.Float=bbbfly.wrapper.float.left}ng_MergeDef(a,c);return a};
bbbfly.wrapper._trackChildControl=function(a,b){b&&"undefined"===typeof b._trackedBounds&&"undefined"===typeof b._trackedFloat&&"function"===typeof b.AddEvent&&(b.AddEvent("OnVisibleChanged",bbbfly.wrapper._onChildControlVisibleChanged,!0),b.AddEvent("OnUpdated",bbbfly.wrapper._onChildControlUpdated,!0),b._parentWrapper=a,b._trackedBounds=null,b._trackedFloat=null)};
bbbfly.wrapper._onChildControlVisibleChanged=function(){var a=bbbfly.wrapper._getWrapperOptions(this._parentWrapper);a=bbbfly.wrapper._getWrapOptions(this,a);a.TrackChanges&&a.Float&&this._parentWrapper.Update(!1)};
bbbfly.wrapper._onChildControlUpdated=function(){var a=bbbfly.wrapper._getWrapperOptions(this._parentWrapper),b=bbbfly.wrapper._getWrapOptions(this,a);if(b.TrackChanges){var c=this.Bounds?ng_CopyVar(this.Bounds):{},d=this._trackedBounds?this._trackedBounds:{};this._trackedBounds=c;var f=b.Float,g=this._trackedFloat;this._trackedFloat=f;if(f!==g)this._parentWrapper.Update(!1);else switch(a.Orientation){case bbbfly.wrapper.orientation.vertical:if(c.H===d.H)break;b.Float!==bbbfly.wrapper.float.top&&
b.Float!==bbbfly.wrapper.float.bottom&&b.Float!==bbbfly.wrapper.float.stretch||this._parentWrapper.Update(!1);break;case bbbfly.wrapper.orientation.horizontal:c.W!==d.W&&(b.Float!==bbbfly.wrapper.float.left&&b.Float!==bbbfly.wrapper.float.right&&b.Float!==bbbfly.wrapper.float.stretch||this._parentWrapper.Update(!1))}}};
bbbfly.wrapper._setMargin=function(a,b,c,d){var f=null,g=b;switch(b){case "start":g="end";break;case "end":g="start"}switch(d){case "margin":f=c[a.margin[g]];break;case "value":f=a.value.margin[g]}"number"===typeof f&&(c=a.value.margin[b],"number"!==typeof c||f>c)&&(a.value.margin[b]=f);bbbfly.wrapper._addMargin(a,b)};bbbfly.wrapper._addMargin=function(a,b){var c=a.value.margin[b];if("number"===typeof c)switch(b){case "start":a.value.position.end+=c;break;case "end":a.value.position.start+=c}};
bbbfly.wrapper._overwriteMargin=function(a,b,c,d){c=c[a[d][b]];a.value.margin[b]="number"===typeof c?c:null};
bbbfly.wrapper._positionCtrl=function(a,b,c,d){switch(d.Orientation){case bbbfly.wrapper.orientation.vertical:d="T";var f="B";var g="H";break;case bbbfly.wrapper.orientation.horizontal:d="L";f="R";g="W";break;default:return}b=b.value.position;var e={};switch(c){case "start":e[d]=b.start;e[f]=void 0;break;case "end":e[f]=b.end;e[d]=void 0;break;case "hide":e[d]=b.start;e[f]=void 0;e[g]=0;break;case "stretch":e[d]=b.start,e[f]=b.end,e[g]=void 0}a.SetBounds(e)&&a.Update();switch(c){case "start":case "end":a=
a.Bounds[g],"number"===typeof a&&(b[c]+=a)}};bbbfly.wrapper._positionStretcher=function(a,b,c,d){switch(d.Orientation){case bbbfly.wrapper.orientation.vertical:d={T:void 0,B:void 0,H:0,L:0,R:0,W:void 0};switch(c){case "start":d.T=b.value.position.start;break;case "end":d.B=b.value.position.end}a.SetBounds(d);break;case bbbfly.wrapper.orientation.horizontal:d={L:void 0,R:void 0,W:0,T:0,B:0,H:void 0};switch(c){case "start":d.L=b.value.position.start;break;case "end":d.R=b.value.position.end}a.SetBounds(d)}};
bbbfly.wrapper._canPlaceStretchCtrls=function(a,b,c,d){if(!d.AutoSize&&0<b.length){b=Infinity;if(a=(a.ControlsPanel?a.ControlsPanel:a).Elm()){ng_BeginMeasureElement(a);switch(d.Orientation){case bbbfly.wrapper.orientation.vertical:b=ng_ClientHeight(a);break;case bbbfly.wrapper.orientation.horizontal:b=ng_ClientWidth(a)}ng_EndMeasureElement(a)}c=c.value.position;return c.start<b&&c.end<b}return!1};
bbbfly.wrapper._autoSize=function(a,b,c){b=b.value.position.start+b.value.position.end;var d=a.ControlsPanel;if(d&&d.Bounds)switch(c.Orientation){case bbbfly.wrapper.orientation.vertical:"number"===typeof d.Bounds.T&&(b+=d.Bounds.T);"number"===typeof d.Bounds.B&&(b+=d.Bounds.B);break;case bbbfly.wrapper.orientation.horizontal:"number"===typeof d.Bounds.L&&(b+=d.Bounds.L);"number"===typeof d.Bounds.R&&(b+=d.Bounds.R);break;default:return}d=!1;switch(c.Orientation){case bbbfly.wrapper.orientation.vertical:a.SetBounds({H:b})&&
(d=!0,a.Update());break;case bbbfly.wrapper.orientation.horizontal:a.SetBounds({W:b})&&(d=!0,a.Update())}d&&"function"===typeof a.OnAutoSized&&a.OnAutoSized()};bbbfly.WrapperPanel=function(a,b,c){a=a||{};ng_MergeDef(a,{ScrollBars:ssAuto,Data:{WrapperOptions:void 0,_Stretcher:null},OnCreated:bbbfly.wrapper._onCreated,Events:{OnUpdated:bbbfly.wrapper._onUpdated,OnAutoSized:null}});return ngCreateControlAsType(a,"ngPanel",b,c)};
bbbfly.WrapperGroup=function(a,b,c){a=a||{};ng_MergeDef(a,{ScrollBars:ssNone,Data:{WrapperOptions:void 0,_Stretcher:null},OnCreated:bbbfly.wrapper._onCreated,Events:{OnUpdated:bbbfly.wrapper._onUpdated,OnAutoSized:null}});return ngCreateControlAsType(a,"ngGroup",b,c)};bbbfly.wrapper.orientation={vertical:1,horizontal:2};bbbfly.wrapper.float={none:0,top:1,bottom:2,left:3,right:4,stretch:5};ngUserControls=ngUserControls||[];
ngUserControls.bbbfly_wrapper={OnInit:function(){ngRegisterControlType("bbbfly.WrapperPanel",bbbfly.WrapperPanel);ngRegisterControlType("bbbfly.WrapperGroup",bbbfly.WrapperGroup)}};
