/*!
 * @author Jan Nejedly support@3b-fly.eu
 * @copyright Jan Nejedly
 * @version 2.0.1
 * @license see license in 'LICENSE' file
*/

var bbbfly=bbbfly||{};bbbfly.menu={};bbbfly.menubar={};bbbfly.menu._normalizeItems=function(a){a.Data.Items=bbbfly.menu._itemsToArray(a.Data.Items)};bbbfly.menu._itemsToArray=function(a){if(Array.isArray(a))return a;if(!Object.isObject(a))return[];var b=[],c;for(c in a){var e=a[c];0<b.length&&b.push({Text:"-"});for(var d in e){var f=e[d];f.SubMenu&&(f.SubMenu=bbbfly.menu._itemsToArray(f.SubMenu));b.push(f)}}return b};
bbbfly.menu._add=function(a,b){"undefined"===typeof a.CloseOnClick&&(a.CloseOnClick=!a.SubMenu);a.Owner=this;this.Add.callParent(a,b)};bbbfly.menu._onMenuClick=function(a,b,c){"undefined"===typeof c.Checked&&"undefined"===typeof c.RadioGroup||b.CheckItem(c,!c.Checked);return!!c.CloseOnClick};bbbfly.menubar._doCreate=function(a,b,c){this.DoCreate.callParent(a,b,c);this.FillItems()};bbbfly.menubar._setItems=function(a){if(!Object.isObject(a))return!1;this.Items=a;this.FillItems();this.Update();return!0};
bbbfly.menubar._getItems=function(){return Object.isObject(this.Items)?this.Items:null};
bbbfly.menubar._fillItems=function(){for(b in this._Buttons){var a=this._Buttons[b];Function.isFunction(a.Dispose)&&(this._Buttons.pop(b),a.Dispose())}var b=this.GetItems();if(Object.isObject(b)){var c=bbbfly.PanelGroup.NewGroupId(),e;for(e in b)if(b.hasOwnProperty(e)&&(a=b[e],Object.isObject(a))){var d={ID:String.isString(a.ID)?a.ID:e,Group:{Selected:c}};String.isString(a.Alt)&&(d.Alt=a.Alt);String.isString(a.AltRes)&&(d.AltRes=a.AltRes);String.isString(a.Text)&&(d.Text=a.Text);String.isString(a.TextRes)&&
(d.TextRes=a.TextRes);Boolean.isBoolean(a.Visible)&&(d.Visible=a.Visible);Boolean.isBoolean(a.Enabled)&&(d.Enabled=a.Enabled);Object.isObject(a.Icon)&&(d.Icon=a.Icon);d={Data:d};a=this.CreateItemButton(a,d);this._Buttons.push(a)}}};bbbfly.menubar._getButtons=function(){return Array.isArray(this._Buttons)?this._Buttons:[]};
bbbfly.menubar._createItemButton=function(a,b){if(!Object.isObject(a))return null;Object.isObject(b)||(b={});var c=this.ButtonDef;Object.isObject(c)&&ng_MergeDef(b,c);b=this.CreateControl(b);if(!b)return null;b._Bar=this;b._Item=a;return b};bbbfly.menubar._onButtonClick=function(){var a=this._Bar;Object.isObject(a)&&Function.isFunction(a.OnItemClick)&&a.OnItemClick(this._Item,this.Selected)};
bbbfly.menubar._onButtonSelectedChanged=function(){var a=this._Bar;Object.isObject(a)&&Function.isFunction(a.OnItemSelectedChanged)&&a.OnItemSelectedChanged(this._Item,this.Selected)};bbbfly.Menu=function(a,b,c){a=a||{};ng_MergeDef(a,{Data:{Items:null},Events:{OnMenuClick:bbbfly.menu._onMenuClick},Methods:{Add:bbbfly.menu._add}});bbbfly.menu._normalizeItems(a);return ngCreateControlAsType(a,"ngMenu",b,c)};
bbbfly.MenuBar=function(a,b,c){a=a||{};ng_MergeDef(a,{Data:{BarOptions:{TrackChanges:!0},ButtonDef:{Type:"bbbfly.Button",Data:{SelectType:bbbfly.Button.selecttype.click},Events:{OnSelectedChanged:bbbfly.menubar._onButtonSelectedChanged,OnClick:bbbfly.menubar._onButtonClick}},Items:null,_Buttons:[]},Events:{OnItemClick:null,OnItemSelectedChanged:null},Methods:{DoCreate:bbbfly.menubar._doCreate,SetItems:bbbfly.menubar._setItems,GetItems:bbbfly.menubar._getItems,FillItems:bbbfly.menubar._fillItems,GetButtons:bbbfly.menubar._getButtons,
CreateItemButton:bbbfly.menubar._createItemButton}});return ngCreateControlAsType(a,"bbbfly.Bar",b,c)};ngUserControls=ngUserControls||[];ngUserControls.bbbfly_menu={OnInit:function(){ngRegisterControlType("bbbfly.Menu",bbbfly.Menu);ngRegisterControlType("bbbfly.MenuBar",bbbfly.MenuBar)}};
