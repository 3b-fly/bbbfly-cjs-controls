/*!
 * @author Jan Nejedly support@3b-fly.eu
 * @copyright Jan Nejedly
 * @version 2.0.0
 * @license see license in 'LICENSE' file
*/

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;for(c=c||0;c<e;c++)if(b[c]==a||Object.is(b[c],a))return!0;return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");var bbbfly=bbbfly||{};bbbfly.map=bbbfly.map||{};
bbbfly.map.box={};bbbfly.map.box._onCreated=function(a){bbbfly.listener.SetListenable(a,!0);bbbfly.MapRegistry.RegisterMap(a);return!0};bbbfly.map.box._onUpdate=function(){this._MapControlsRegistered||(this.RegisterControls(),this._MapControlsRegistered=!0);return!0};
bbbfly.map.box._doCreateMap=function(a){a||(a={});a.drawControl=!1;a.attributionControl=!1;a.zoomControl=!1;a=this.DoCreateMap.callParent(a);if(!a)return null;this._DrawingsFeature=new L.FeatureGroup;this._DrawingsFeature.addTo(a);!1!==this.Drawings&&(this.Drawings=new bbbfly.MapDrawingsHandler(this._DrawingsFeature,this.Drawings));this.CreateDrawControls(a);return a};
bbbfly.map.box._createDrawControls=function(a){if(!a)return null;a.on("draw:created",bbbfly.map.box._onDrawCreated);a.on("draw:deleted",bbbfly.map.box._onDrawDeleted);var b=!!(this.MapControls&bbbfly.MapBox.control.drawMarker),c=!!(this.MapControls&bbbfly.MapBox.control.drawGeometry);(b||c)&&L.Control.Draw&&(L.drawLocal=ngTxt("bbbfly_map_control_draw"),this._DrawControl=(new L.Control.Draw({position:"topright",draw:{polygon:c?{repeatMode:!0}:!1,polyline:c?{repeatMode:!0}:!1,rectangle:c?{repeatMode:!0}:
!1,circle:!1,circlemarker:!1,marker:b},edit:{featureGroup:this._DrawingsFeature}})).addTo(a));this._DrawDrawing&&this.SetDrawControlDrawing(this._DrawDrawing)};
bbbfly.map.box._onDrawCreated=function(a){var b=a.target.Owner;if(b._DrawDrawing)if(a.layer instanceof L.Marker){b.DrawSingleIcon&&b.Drawings.ClearIcons();var c=ng_CopyVar(b._DrawDrawing.Options);c.Point=a.layer.getLatLng();b.Drawings.AddDrawing(new bbbfly.MapDrawingItem(c))}else a.layer instanceof L.Polyline&&(b.DrawSingleGeometry&&b.Drawings.ClearGeometries(),c=ng_CopyVar(b._DrawDrawing.Options),c.Geometry=a.layer.toGeoJSON(),b.Drawings.AddDrawing(new bbbfly.MapDrawingItem(c)))};
bbbfly.map.box._onDrawDeleted=function(a){a.layers instanceof L.LayerGroup&&a.layers.eachLayer(function(a){var b=a.Owner;b instanceof bbbfly.MapDrawingItem&&(a instanceof L.Marker?b.RemoveIcon(a):a instanceof L.Polyline&&b.RemoveGeometry(a))})};
bbbfly.map.box._registerControls=function(){if(this.Controls)for(var a in this.Controls){var b=this.Controls[a];Object.isObject(b)&&Function.isFunction(b.CtrlInheritsFrom)&&b.CtrlInheritsFrom("bbbfly.MapControl")&&!String.isString(b.MapID)&&(b.MapID=this.ID,bbbfly.MapRegistry.RegisterControl(b))}};
bbbfly.map.box._linkMapControl=function(a,b){if(!(String.isString(a)&&b&&Function.isFunction(b.GetListener)&&Function.isFunction(this.AddListener)))return!1;var c=b.GetListener();if(c&&!this.AddListener(c.Listen,c))return!1;Array.isArray(this._MapControls[a])||(this._MapControls[a]=[]);a=this._MapControls[a];Array.includes(a,b)||a.push(b);return!0};
bbbfly.map.box._unlinkMapControl=function(a,b){if(!(String.isString(a)&&b&&Function.isFunction(b.GetListener)&&Function.isFunction(this.RemoveListener)))return!1;var c=b.GetListener();if(c&&!this.RemoveListener(c.Listen,c))return!1;a=this._MapControls[a];b=Array.indexOf(a,b);0<b&&a.splice(b,1);return!0};
bbbfly.map.box._getMapControls=function(a){var b=[],c={},d;for(d in this._MapControls)if(!String.isString(a)||d===a){var e=this._MapControls[a];if(Array.isArray(e))for(var g in e){var f=e[g];if(String.isString(f.ID)){if(c[f.ID])continue;c[f.ID]=!0}b.push(f)}}return b};bbbfly.map.box._setMapControlsVisible=function(a,b){if(!String.isString(a))return!1;Boolean.isBoolean(b)||(b=!0);a=this.GetMapControls(a);for(var c in a){var d=a[c];d&&Function.isFunction(d.SetVisible)&&d.SetVisible(b)}};
bbbfly.map.box._fitDrawing=function(a){var b=this.Drawings;return b instanceof bbbfly.MapDrawingsHandler&&(a=b.GetDrawing(a))?((b=a.GetPoint())||(b=a.GetGeometryCenter()),this.FitCoords(b)):!1};bbbfly.map.box._fitDrawings=function(){if(this._DrawingsFeature){var a=this._DrawingsFeature.getBounds();if(a.isValid())return this.FitBounds(a)}return!1};
bbbfly.map.box._setMode=function(a,b){if(!String.isString(a)||!String.isString(b)&&null!==b)return!1;if(null===b){var c=!!this._MapMode[a];delete this._MapMode[a]}else c=b!==this._MapMode[a],this._MapMode[a]=b;c&&Function.isFunction(this.OnModeChanged)&&this.OnModeChanged(a,b);return!0};bbbfly.map.box._getMode=function(a){return this._MapMode&&String.isString(this._MapMode[a])?this._MapMode[a]:null};bbbfly.map.box._getModes=function(){return this._MapMode?this._MapMode:{}};
bbbfly.map.box._setDrawControlDrawing=function(a){if(!(a instanceof bbbfly.MapDrawingItem))return!1;this._DrawDrawing=a;if(this._DrawControl){var b=a.NewIcon({readonly:!0,selected:!0});a=a.GetGeometryStyle();this._DrawControl.setDrawingOptions({marker:{icon:b},polygon:{shapeOptions:a},polyline:{shapeOptions:a},rectangle:{shapeOptions:a}})}return!0};bbbfly.map.box._stopDrawControlActions=function(){if(this._DrawControl)for(var a in this._DrawControl._toolbars)this._DrawControl._toolbars[a].disable()};
bbbfly.MapBox=function(a,b,c){a=a||{};ng_MergeDef(a,{Data:{MapControls:bbbfly.MapBox.control.none,Drawings:null,DrawSingleIcon:!1,DrawSingleGeometry:!1,_DrawingsFeature:null,_DrawControl:null,_DrawDrawing:null,_MapControls:{},_MapControlsRegistered:!1,_MapMode:{},ChildHandling:ngChildEnabledParentAware},OnCreated:bbbfly.map.box._onCreated,Events:{OnUpdate:bbbfly.map.box._onUpdate,OnModeChanged:null},Methods:{DoCreateMap:bbbfly.map.box._doCreateMap,RegisterControls:bbbfly.map.box._registerControls,
CreateDrawControls:bbbfly.map.box._createDrawControls,LinkMapControl:bbbfly.map.box._linkMapControl,UnlinkMapControl:bbbfly.map.box._unlinkMapControl,GetMapControls:bbbfly.map.box._getMapControls,SetMapControlsVisible:bbbfly.map.box._setMapControlsVisible,FitDrawing:bbbfly.map.box._fitDrawing,FitDrawings:bbbfly.map.box._fitDrawings,SetMode:bbbfly.map.box._setMode,GetMode:bbbfly.map.box._getMode,GetModes:bbbfly.map.box._getModes,SetDrawControlDrawing:bbbfly.map.box._setDrawControlDrawing,StopDrawControlActions:bbbfly.map.box._stopDrawControlActions}});
var d=a.Data.MapControls;d&&(d&bbbfly.MapBox.control.copyrights&&ng_MergeDef(a,{Controls:{Copyrights:{Type:"bbbfly.MapCopyrights",style:{zIndex:3},Data:{Visible:!1}}}}),d&bbbfly.MapBox.control.layers&&ng_MergeDef(a,{Controls:{Layers:{Type:"bbbfly.MapLayers",style:{zIndex:3},Data:{Visible:!1}}}}),d&bbbfly.MapBox.control.drawBar&&ng_MergeDef(a,{Controls:{DrawBar:{Type:"bbbfly.MapDrawBar",style:{zIndex:2}}}}),d&bbbfly.MapBox.control.modeBar&&ng_MergeDef(a,{Controls:{ModeBar:{Type:"bbbfly.MapModeBar",
style:{zIndex:2}}}}),d&bbbfly.MapBox.control.sideBar&&ng_MergeDef(a,{Controls:{SideBar:{Type:"bbbfly.MapSideBar",style:{zIndex:2},Data:{MapControls:d}}}}),d&bbbfly.MapBox.control.zoomSlider&&ng_MergeDef(a,{Controls:{ZoomSlider:{Type:"bbbfly.MapZoomSlider",style:{zIndex:2}}}}));bbbfly.listener.Initialize();return ngCreateControlAsType(a,"bbbfly.Map",b,c)};bbbfly.MapBox.control={none:0,copyrights:1,layers:2,drawBar:4,modeBar:8,sideBar:16,zoomSlider:32,drawMarker:64,drawGeometry:128};
ngUserControls=ngUserControls||[];ngUserControls.bbbfly_map_box={OnInit:function(){ngRegisterControlType("bbbfly.MapBox",bbbfly.MapBox)}};
