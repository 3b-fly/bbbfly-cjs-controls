/*!
 * @author Jan Nejedly support@3b-fly.eu
 * @copyright Jan Nejedly
 * @version 2.0.1
 * @license see license in 'LICENSE' file
*/

var bbbfly=bbbfly||{};bbbfly.map=bbbfly.map||{};bbbfly.map.control=bbbfly.map.control||{};bbbfly.map.control.sidebar={control_type:"sidebar"};bbbfly.map.control.sidebar._onLinkedToMap=function(a){if(a&&Array.isArray(this._Buttons)){var b=this._Buttons,e;for(e in b)b[e].SetMap(a)}};bbbfly.map.control.sidebar._createListener=function(){return{Listen:["OnMapControlChanged"],OnMapControlChanged:bbbfly.map.control.sidebar._onMapControlChanged}};
bbbfly.map.control.sidebar._onMapControlChanged=function(a){var b=this.Owner.GetMap(),e=this.Owner._Buttons;if(b&&Array.isArray(e)){b=b.GetMapControls(a);for(var c in e){var d=e[c];if(d.Target===a){var f=!1,g;for(g in b)if(b[g].Visible){f=!0;break}d.SetVisible(0<b.length);d.SetSelected(f)}}}};
bbbfly.map.control.sidebar._onBtnCreated=function(a){for(var b=a;a;){a=a.ParentControl;if(!a)break;if(Function.isFunction(a.CtrlInheritsFrom)&&a.CtrlInheritsFrom("bbbfly.MapSideBar")){b.SetMap(a.GetMap());a=a._Buttons;Array.isArray(a)&&a.push(b);break}}};bbbfly.map.control.sidebar._setBtnMap=function(a){Object.isObject(a)&&Function.isFunction(a.CtrlInheritsFrom)&&a.CtrlInheritsFrom("bbbfly.MapBox")?this._Map=a:this._Map=null};bbbfly.map.control.sidebar._getBtnMap=function(){return this._Map};
bbbfly.map.control.sidebar._onBtnSelectedChanged=function(){var a=this.GetMap();if(a&&this.Target)switch(this.Action){case bbbfly.MapSideBar.action.map_control:a.SetMapControlsVisible(this.Target,!!this.Selected)}};
bbbfly.MapSideBar=function(a,b,e){a=a||{};ng_MergeDef(a,{SectionDef:{Type:"bbbfly.Panel",ParentReferences:!1},ButtonDef:{Type:"bbbfly.Button",Data:{SelectType:bbbfly.Button.selecttype.both,_Map:null},OnCreated:bbbfly.map.control.sidebar._onBtnCreated,Events:{OnSelectedChanged:bbbfly.map.control.sidebar._onBtnSelectedChanged},Methods:{SetMap:bbbfly.map.control.sidebar._setBtnMap,GetMap:bbbfly.map.control.sidebar._getBtnMap}},Data:{ControlType:bbbfly.map.control.sidebar.control_type,MapControls:bbbfly.MapBox.control.none,
_Buttons:[]},Events:{OnLinkedToMap:bbbfly.map.control.sidebar._onLinkedToMap},Methods:{CreateListener:bbbfly.map.control.sidebar._createListener,GetButtonAlt:null,GetButtonIcon:null}});var c=a.Data.MapControls;if(c){var d={};c&bbbfly.MapBox.control.layers&&(d.Layers={Data:{Action:bbbfly.MapSideBar.action.map_control,Target:bbbfly.map.control.layers.control_type,AltRes:"bbbfly_map_control_sidebar_layers",Group:{selected:"map_control"}}});c&bbbfly.MapBox.control.copyrights&&(d.Copyrights={Data:{Action:bbbfly.MapSideBar.action.map_control,
Target:bbbfly.map.control.copyrights.control_type,AltRes:"bbbfly_map_control_sidebar_copyrights",Group:{selected:"map_control"}}});ng_MergeDef(a,{Controls:{MapControls:{Controls:d}}})}for(var f in a.Controls)if(c=a.Controls[f]){if(c.Controls)for(var g in c.Controls)(d=c.Controls[g])&&a.ButtonDef&&ng_MergeDef(d,ng_CopyVar(a.ButtonDef));a.SectionDef&&ng_MergeDef(c,ng_CopyVar(a.SectionDef))}return ngCreateControlAsType(a,"bbbfly.MapControl",b,e)};bbbfly.MapSideBar.action={map_control:1,map_mode:2};
ngUserControls=ngUserControls||[];ngUserControls.bbbfly_map_control_sidebar={OnInit:function(){ngRegisterControlType("bbbfly.MapSideBar",bbbfly.MapSideBar)}};
