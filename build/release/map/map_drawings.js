/*!
 * @author Jan Nejedly support@3b-fly.eu
 * @copyright Jan Nejedly
 * @version 2.0.0
 * @license see license in 'LICENSE' file
*/

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6","es3");var bbbfly=bbbfly||{};bbbfly.map=bbbfly.map||{};bbbfly.map.drawing={_lastId:0,_styles:{},utils:{},layer:{},core:{},icon:{},geometry:{},handler:{}};bbbfly.map.drawing.utils.GetDrawingId=function(a){a=a?a.ID:null;return String.isString(a)?a:"_"+ ++bbbfly.map.drawing._lastId};
bbbfly.map.drawing.utils.GetDrawingStyle=function(a){a=a?a.Style:null;String.isString(a)&&(a=bbbfly.map.drawing._styles[a]);return Object.isObject(a)?a:{}};bbbfly.map.drawing.utils.DefineDrawingStyle=function(a,b){if(!Object.isObject(b)||!String.isString(a))return!1;var c=bbbfly.map.drawing._styles;if("undefined"!==typeof c[a])return!1;c[a]=b;return!0};bbbfly.map.drawing.utils.IsLatLng=function(a){return Array.isArray(a)||a instanceof L.LatLng};
bbbfly.map.drawing.utils.NormalizeGeoJSON=function(a){if(a&&a.features){var b=function(a,b,c){for(var d in a.geometry.coordinates)c.push({type:"Feature",properties:a.properties,geometry:{type:b,coordinates:a.geometry.coordinates[d]}})},c=[],d;for(d in a.features){var e=a.features[d];if(e.geometry)switch(e.geometry.type){case "MultiLineString":b(e,"LineString",c);break;case "MultiPolygon":b(e,"Polygon",c);break;default:c.push(e)}}a.features=c}return a};
bbbfly.map.drawing.utils.InitMouseEvents=function(a,b,c){a instanceof L.Layer&&(String.isString(b)||(b=""),Function.isFunction(c)||(c=bbbfly.map.drawing.layer._onMouseEvent),a.on(b+"mouseover",c),a.on(b+"mouseout",c),a.on(b+"click",c),a.on(b+"dblclick",c),a.on(b+"contextmenu",c))};
bbbfly.map.drawing.layer._onMouseEvent=function(a){var b=a.target.Owner,c=null;switch(a.type){case "mouseover":c=b.OnMouseEnter;break;case "mouseout":c=b.OnMouseLeave;break;case "click":c=b.OnClick;break;case "dblclick":c=b.OnDblClick;break;case "contextmenu":c=b.OnRightClick}Function.isFunction(c)&&c.apply(b,[a.target,a.sourceTarget])};
bbbfly.map.drawing.layer._updateZIndex=function(a){if(this.Owner.GetStateValue(bbbfly.MapDrawing.state.selected)){var b=this.options?this.options.riseOffset:0;a=a>b?a:b}this._updateZIndex.callParent(a)};bbbfly.map.drawing.core._getStyle=function(){return bbbfly.map.drawing.utils.GetDrawingStyle(this.Options)};
bbbfly.map.drawing.core._getState=function(){var a={mouseover:this.GetStateValue(bbbfly.MapDrawing.state.mouseover),disabled:this.GetStateValue(bbbfly.MapDrawing.state.disabled),selected:this.GetStateValue(bbbfly.MapDrawing.state.selected),grayed:this.GetStateValue(bbbfly.MapDrawing.state.grayed)};a.disabled&&(a.mouseover=!1);return a};bbbfly.map.drawing.core._getStateValue=function(a){return!!(this._State&a)};
bbbfly.map.drawing.core._setStateValue=function(a,b,c){if(b===!!(this._State&a))return!1;this._State=b?this._State|a:this._State^a;c&&this.Update();return!0};bbbfly.map.drawing.core._getSelected=function(){return this.GetStateValue(bbbfly.MapDrawing.state.selected)};bbbfly.map.drawing.core._setSelected=function(a,b){Boolean.isBoolean(a)||(a=!0);if(this.GetSelected()===a)return!0;Boolean.isBoolean(b)||(b=!0);this.SetStateValue(bbbfly.MapDrawing.state.selected,a,b);return!0};
bbbfly.map.drawing.core._initialize=function(){if(this._Initialized)return!0;if(!Function.isFunction(this.Create))return!1;var a=this.Create();if(Object.isObject(a))this.DoInitialize(a);else if(Array.isArray(a))for(var b in a)this.DoInitialize(a[b]);return this._Initialized=!0};bbbfly.map.drawing.core._doInitialize=function(a){if(!(a instanceof L.Layer))return!1;bbbfly.map.drawing.utils.InitMouseEvents(a);a.Owner=this;L.Util.stamp(a);this._Layers.push(a);return!0};
bbbfly.map.drawing.core._dispose=function(){this.Scan(function(a){a.remove()});this._Layers=[];this._ParentFeature=null;this._Initialized=!1};bbbfly.map.drawing.core._update=function(){this.GetStateValue(bbbfly.MapDrawing.state.disabled)||this.GetStateValue(bbbfly.MapDrawing.state.mouseover)||this.GetStateValue(bbbfly.MapDrawing.state.selected)};
bbbfly.map.drawing.core._addTo=function(a){return this._ParentFeature?!1:a instanceof L.FeatureGroup?(this.Initialize(),this.Scan(function(b){b.addTo(a)}),this._ParentFeature=a,this.Update(),!0):!1};bbbfly.map.drawing.core._removeFrom=function(a){a||(a=this._ParentFeature);return a===this._ParentFeature?(this.Scan(function(b){b.removeFrom(a)}),this._ParentFeature=null,!0):!1};
bbbfly.map.drawing.core._scan=function(a,b){Boolean.isBoolean(b)||(b=!1);if(Function.isFunction(a))for(var c in this._Layers){var d=a(this._Layers[c]);if(Boolean.isBoolean(d))return d}return b};bbbfly.map.drawing.core._onMouseEnter=function(){this.SetStateValue(bbbfly.MapDrawing.state.mouseover,!0);bbbfly.Renderer.UpdateStackHTML(this._IconProxy,this.GetState())};
bbbfly.map.drawing.core._onMouseLeave=function(){this.SetStateValue(bbbfly.MapDrawing.state.mouseover,!1);bbbfly.Renderer.UpdateStackHTML(this._IconProxy,this.GetState())};bbbfly.map.drawing.core._onClick=function(){this.Options.SelectType&bbbfly.MapDrawing.selecttype.click&&this.SetSelected(!this.GetSelected(),!0)};bbbfly.map.drawing.core._onDblClick=function(){this.Options.SelectType&bbbfly.MapDrawing.selecttype.dblclick&&this.SetSelected(!this.GetSelected(),!0)};
bbbfly.map.drawing.icon._create=function(){var a=this.Options.Coordinates,b=null;bbbfly.map.drawing.utils.IsLatLng(a)&&(b=L.marker(a,{riseOnHover:!0,riseOffset:999999}),ng_OverrideMethod(b,"_updateZIndex",bbbfly.map.drawing.layer._updateZIndex));return b};
bbbfly.map.drawing.icon._update=function(){var a=this.GetStyle(),b=this.GetState(),c=b.mouseover;b.mouseover=!1;var d=bbbfly.Renderer.StackProxy(a.images,b,this.ID+"_I"),e=bbbfly.Renderer.StackHTML(d,b,"MapIconImg");this._IconProxy=d;b.mouseover=c;if(e!==this._IconHtml){this._IconHtml=e;var f=L.divIcon({iconSize:[d.W,d.H],iconAnchor:[d.Anchor.L,d.Anchor.T],className:a.className,html:e});this.Scan(function(a){a.setIcon(f)});c&&bbbfly.Renderer.UpdateStackHTML(d,b)}this.Update.callParent()};
bbbfly.map.drawing.geometry._create=function(){var a=this.GetStyle(),b=this.Options.GeoJSON;b instanceof L.GeoJSON||(b=bbbfly.map.drawing.utils.NormalizeGeoJSON(b),b=new L.GeoJSON(b));b=b.getLayers();if(!Array.isArray(b))return[];for(var c in b){var d=b[c];d.setStyle(a);ng_OverrideMethod(d,"_project",bbbfly.map.drawing.geometry._project)}return b};
bbbfly.map.drawing.geometry._project=function(){this._project.callParent();var a=this.getElement();if(a){var b=this.Owner.Options.MinPartSize,c="block";if(Number.isInteger(b)){var d=this._pxBounds.getSize();if(d.x<b||d.y<b)c="none"}a.style.display=c}};bbbfly.map.drawing.handler._getDrawing=function(a){a=this._Drawings[a];return a instanceof bbbfly.MapDrawing?a:null};
bbbfly.map.drawing.handler._addDrawing=function(a){return a instanceof bbbfly.MapDrawing&&String.isString(a.ID)&&!this._Drawings[a.ID]&&a.AddTo(this._Feature)?(this._Drawings[a.ID]=a,!0):!1};bbbfly.map.drawing.handler._removeDrawing=function(a){return a instanceof bbbfly.MapDrawing&&String.isString(a.ID)&&this._Drawings[a.ID]&&a.RemoveFrom()?(delete this._Drawings[a.ID],!0):!1};
bbbfly.MapDrawing=function(a){Object.isObject(a)||(a=null);this.ID=bbbfly.map.drawing.utils.GetDrawingId(a);this.Options=Object.isObject(a)?a:{};this._State=0;this._Layers=[];this._ParentFeature=null;this._Initialized=!1;this.Initialize=bbbfly.map.drawing.core._initialize;this.DoInitialize=bbbfly.map.drawing.core._doInitialize;this.GetStyle=bbbfly.map.drawing.core._getStyle;this.GetState=bbbfly.map.drawing.core._getState;this.GetStateValue=bbbfly.map.drawing.core._getStateValue;this.SetStateValue=
bbbfly.map.drawing.core._setStateValue;this.GetSelected=bbbfly.map.drawing.core._getSelected;this.SetSelected=bbbfly.map.drawing.core._setSelected;this.Dispose=bbbfly.map.drawing.core._dispose;this.Create=null;this.Update=bbbfly.map.drawing.core._update;this.AddTo=bbbfly.map.drawing.core._addTo;this.RemoveFrom=bbbfly.map.drawing.core._removeFrom;this.Scan=bbbfly.map.drawing.core._scan;this.OnMouseEnter=bbbfly.map.drawing.core._onMouseEnter;this.OnMouseLeave=bbbfly.map.drawing.core._onMouseLeave;this.OnClick=
bbbfly.map.drawing.core._onClick;this.OnDblClick=bbbfly.map.drawing.core._onDblClick;this.OnRightClick=null};bbbfly.MapDrawing.state={mouseover:1,disabled:2,selected:4,grayed:8};bbbfly.MapDrawing.selecttype={none:0,click:1,dblclick:2,both:3};bbbfly.MapIcon=function(a){a=new bbbfly.MapDrawing(a);a._IconProxy=null;a._IconHtml="";ng_OverrideMethod(a,"Create",bbbfly.map.drawing.icon._create);ng_OverrideMethod(a,"Update",bbbfly.map.drawing.icon._update);return a};
bbbfly.MapIcon.Style=function(a,b){Array.isArray(a)||(a=null);String.isString(b)||(b="");this.images=a;this.className=b};bbbfly.MapGeometry=function(a){a=new bbbfly.MapDrawing(a);ng_OverrideMethod(a,"Create",bbbfly.map.drawing.geometry._create);return a};bbbfly.MapGeometry.Style=function(a,b){String.isString(a)||(a="#000000");Number.isInteger(b)||(b=0);this.color=a;this.weight=b;this.stroke=0<b;this.fill=!0;this.fillColor=a;this.fillOpacity=.2};
bbbfly.MapDrawingsHandler=function(a){if(!(a instanceof L.FeatureGroup))return null;this._Feature=a;this._Drawings={};this.GetDrawing=bbbfly.map.drawing.handler._getDrawing;this.AddDrawing=bbbfly.map.drawing.handler._addDrawing;this.RemoveDrawing=bbbfly.map.drawing.handler._removeDrawing;return this};
